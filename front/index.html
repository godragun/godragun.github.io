<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome - Portfolio</title>
    <meta name="description" content="Harendra Thennakoon - Computer Engineering Student & Future Innovator">
    
    <!-- Enhanced Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://prod.spline.design; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https:; connect-src 'self' https://prod.spline.design https://unpkg.com;">
    <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp">
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=(), interest-cohort=()">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Welcome text in background -->
    <div class="welcome-text">WELCOME</div>
    
    <!-- Loading Indicator -->
    <div id="loading-indicator" style="
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 100;
        text-align: center;
        color: #64ffda;
        font-family: Arial, sans-serif;
    ">
        <div style="
            width: 60px;
            height: 60px;
            border: 3px solid rgba(100, 255, 218, 0.3);
            border-top: 3px solid #64ffda;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        "></div>
        <div style="font-size: 18px; font-weight: 500;">Loading 3D Experience...</div>
        <div style="font-size: 14px; opacity: 0.7; margin-top: 10px;">Please wait a moment</div>
        <button id="skip-3d-btn" onclick="window.location.href='../index.html'" style="
            margin-top: 20px;
            padding: 10px 20px;
            background: rgba(100, 255, 218, 0.1);
            border: 1px solid #64ffda;
            color: #64ffda;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        " onmouseover="this.style.background='rgba(100, 255, 218, 0.2)'" onmouseout="this.style.background='rgba(100, 255, 218, 0.1)'">
            Skip to Portfolio
        </button>
    </div>

    <!-- Security Layer 3: Obfuscated Spline Integration -->
    <script type="module" src="https://unpkg.com/@splinetool/viewer@1.10.64/build/spline-viewer.js"></script>
    
    <!-- Direct Spline Viewer as Primary Method -->
    <spline-viewer 
        url="https://prod.spline.design/r5mqQnNU3ofM85w7/scene.splinecode"
        loading="eager"
        style="width: 100%; height: 100vh; display: block; position: absolute; top: 0; left: 0; z-index: 2;"
        id="primary-spline-viewer"
        crossorigin="anonymous"
    ></spline-viewer>
    
    <!-- Backup Container for Dynamic Loading -->
    <div id="secure-3d-container" style="width: 100%; height: 100vh; position: absolute; top: 0; left: 0; z-index: 1; display: none;">
        <!-- 3D content will be loaded securely here -->
    </div>

    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    
    <!-- Security Layer 4: Dynamic Secure Loading -->
    <script>
        (function() {
            'use strict';
            
            // Encrypted and obfuscated URL components
            const secureComponents = {
                base: btoa('aHR0cHM6Ly9wcm9kLnNwbGluZS5kZXNpZ24v').split('').reverse().join(''),
                path: btoa('cjVtcVFuTlUzb2ZNO4d3Ny9zY2VuZS5zcGxpbmVjb2Rl').split('').reverse().join(''),
                script: btoa('aHR0cHM6Ly91bnBrZy5jb20vQHNwbGluZXRvb2wvdmlld2VyQDEuMTAuNjQvYnVpbGQvc3BsaW5lLXZpZXdlci5qcw==').split('').reverse().join('')
            };
            
            function decryptComponent(encrypted) {
                return atob(encrypted.split('').reverse().join(''));
            }
            
            function hideLoadingIndicator() {
                const loadingIndicator = document.getElementById('loading-indicator');
                if (loadingIndicator) {
                    loadingIndicator.style.display = 'none';
                }
            }

            function showFallback() {
                console.log('Showing fallback animation');
                hideLoadingIndicator();
                const container = document.getElementById('secure-3d-container');
                if (container) container.style.display = 'none';
                const fallback = document.getElementById('fallback-3d');
                if (fallback) {
                    fallback.style.display = 'block';
                    if (window.initFallback3D) window.initFallback3D();
                }
            }

            function checkPrimarySpline() {
                console.log('Checking primary Spline viewer...');
                const primaryViewer = document.getElementById('primary-spline-viewer');
                
                if (!primaryViewer) {
                    console.log('Primary viewer not found, trying dynamic loading');
                    loadSecureSpline();
                    return;
                }
                
                // Check if primary viewer has loaded
                let attempts = 0;
                const maxAttempts = 20; // 10 seconds
                
                const checkLoading = () => {
                    attempts++;
                    console.log(`Checking primary Spline loading attempt ${attempts}`);
                    
                    // Check if Spline has loaded content
                    if (primaryViewer.shadowRoot && primaryViewer.shadowRoot.children.length > 0) {
                        console.log('Primary Spline loaded successfully!');
                        hideLoadingIndicator();
                        return;
                    }
                    
                    // Check if we've exceeded max attempts
                    if (attempts >= maxAttempts) {
                        console.log('Primary Spline timeout, trying dynamic loading');
                        primaryViewer.style.display = 'none';
                        loadSecureSpline();
                        return;
                    }
                    
                    // Continue checking every 500ms
                    setTimeout(checkLoading, 500);
                };
                
                // Start checking after a short delay
                setTimeout(checkLoading, 1000);
                
                // Listen for load events
                primaryViewer.addEventListener('load', function() {
                    console.log('Primary Spline load event fired');
                    hideLoadingIndicator();
                });
                
                primaryViewer.addEventListener('error', function(e) {
                    console.error('Primary Spline error:', e);
                    primaryViewer.style.display = 'none';
                    loadSecureSpline();
                });
            }

            function loadSecureSpline() {
                console.log('Starting dynamic Spline loading...');
                
                // Show the backup container
                const container = document.getElementById('secure-3d-container');
                if (!container) {
                    console.error('Backup container not found');
                    showFallback();
                    return;
                }
                container.style.display = 'block';
                
                const splineViewer = document.createElement('spline-viewer');
                const splineUrl = decryptComponent(secureComponents.base) + decryptComponent(secureComponents.path);
                console.log('Loading Spline from:', splineUrl);
                
                splineViewer.setAttribute('url', splineUrl);
                splineViewer.setAttribute('loading', 'eager');
                splineViewer.setAttribute('crossorigin', 'anonymous');
                splineViewer.style.cssText = 'width: 100%; height: 100vh; display: block; position: absolute; top: 0; left: 0; z-index: 2;';
                
                container.appendChild(splineViewer);
                
                // Check loading with more patience
                let attempts = 0;
                const maxAttempts = 40; // 20 seconds
                
                const checkSplineLoading = () => {
                    attempts++;
                    console.log(`Checking dynamic Spline loading attempt ${attempts}`);
                    
                    if (splineViewer.shadowRoot && splineViewer.shadowRoot.children.length > 0) {
                        console.log('Dynamic Spline loaded successfully!');
                        hideLoadingIndicator();
                        return;
                    }
                    
                    if (attempts >= maxAttempts) {
                        console.log('Dynamic Spline timeout, showing fallback');
                        showFallback();
                        return;
                    }
                    
                    setTimeout(checkSplineLoading, 500);
                };
                
                setTimeout(checkSplineLoading, 1000);
                
                splineViewer.addEventListener('load', function() {
                    console.log('Dynamic Spline load event fired');
                    hideLoadingIndicator();
                });
                
                splineViewer.addEventListener('error', function(e) {
                    console.error('Dynamic Spline error:', e);
                    showFallback();
                });
            }
            
            // Initialize on DOM ready - try primary Spline first
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', checkPrimarySpline);
            } else {
                checkPrimarySpline();
            }
        })();
    </script>
    
    <!-- Fallback 3D scene using Three.js -->
    <div id="fallback-3d" style="display: none; width: 100%; height: 100vh; position: absolute; top: 0; left: 0; z-index: 2;">
        <canvas id="three-canvas"></canvas>
    </div>
    
    <!-- Navigation -->
    <nav class="navigation">
        <ul>
            <li><a href="../index.html">Portfolio</a></li>
            <li><a href="../index.html#profile">Profile</a></li>
            <li><a href="../index.html#skills">Skills</a></li>
            <li><a href="../index.html#projects">Projects</a></li>
            <li><a href="../index.html#contact">Contact</a></li>
        </ul>
    </nav>

    <!-- Navigation JavaScript -->
    <script>
        // Enhanced navigation for front page
        document.addEventListener('DOMContentLoaded', function() {
            const navigationLinks = document.querySelectorAll('.navigation a');

            navigationLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    // If it's a hash link (section navigation), handle it specially
                    if (this.getAttribute('href').includes('#')) {
                        e.preventDefault();
                        const href = this.getAttribute('href');

                        // Navigate to the main page with the hash
                        window.location.href = href;
                    }
                });
            });
        });
    </script>
    
    <!-- Scroll indicator -->
    <div class="scroll-indicator">
        <div class="scroll-arrow"></div>
        <div>Scroll Down</div>
    </div>
    
    <script src="script.js"></script>
</body>
</html>
